<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwill.billycar.mapper.ReviewMapper">
	<insert id="insertReview">
		 INSERT INTO review (
	        review_id,
	        review_subject,
	        review_content,
	        review_score,
<!-- 	        review_readcount, -->
	        review_reg_date,
	        car_number,
	        review_idx
   		 ) VALUES (
	        #{review_id},
	        #{review_subject},
	        #{review_content},
	        #{review_score},
<!-- 	        0, -->
	        NOW(),
	        #{car_number},
	        #{review_idx}
   		 )
	</insert>
	<select id="selectReviewList" resultType="hashmap">
		SELECT *
   		FROM car c
    	JOIN review r ON c.car_number = r.car_number
    	LEFT JOIN heart h ON r.review_idx = h.review_idx
    	<if test="option.equals('latest')">
    		order by r.review_idx desc
    	</if>
    	<if test="option.equals('old')">
    		order by r.review_idx asc
    	</if>
    	<if test="option.equals('rating')">
    		order by r.review_score desc
    	</if>
    	LIMIT #{startRow},#{listLimit}
	</select>
	
	<select id="selectReviewAvg">
		SELECT IFNULL(AVG(review_score), 0) AS avg_score FROM review;
	</select>
	
	<select id="selectAllReview">
		select count(*) from review;
	</select>
	
	<select id="selectReview" resultType="com.itwill.billycar.vo.ReviewVO">
		SELECT review_id
		     , review_content 
		     , review_score 
		  FROM review
		 WHERE car_number = #{carNumber}
		 LIMIT 3;
	</select>
	<update id="updateReviewHeart">
		update review
		set review_heart = review_heart + #{count}
		where review_idx = #{review_idx}
	</update>
	
	<select id="selectHeart">
		select *
		from heart
		where member_id = #{member_id} AND review_idx = #{review_idx}
	</select>
	<insert id="insertHeart">
		insert into heart values (#{review_idx}, #{member_id})
	</insert>
	<delete id="deleteHeart">
		delete from heart where review_idx = #{review_idx} and member_id = #{member_id}
	</delete>
	
	<select id="selectheartStatus" resultType="com.itwill.billycar.vo.HeartVO">
		select * from heart where member_id = #{member_id} and review_idx = #{review_idx};
	</select>
	
	<select id="heartList" resultType="com.itwill.billycar.vo.HeartVO">
		select * from heart;
	</select>
</mapper>
















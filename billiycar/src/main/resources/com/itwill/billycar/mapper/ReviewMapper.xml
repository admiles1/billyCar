<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwill.billycar.mapper.ReviewMapper">
	<insert id="insertReview">
		 INSERT INTO review (
	        review_id,
	        review_subject,
	        review_content,
	        review_score,
	        review_readcount,
	        review_reg_date,
	        car_number,
	        review_idx
   		 ) VALUES (
	        #{review_id},
	        #{review_subject},
	        #{review_content},
	        #{review_score},
	        0,
	        NOW(),
	        #{car_number},
	        #{review_idx}
   		 )
	</insert>
	<select id="selectReviewList" resultType="hashmap">
		SELECT *
   		FROM car c
    	JOIN review r ON c.car_number = r.car_number
    	<if test="option.equals('latest')">
    		order by review_idx asc;
    	</if>
    	<if test="option.equals('old')">
    		order by review_idx desc;
    	</if>
    	<if test="option.equals('rating')">
    		order by review_score desc;
    	</if>
	</select>
	
	<select id="selectReviewAvg">
		SELECT IFNULL(AVG(review_score), 0) AS avg_score FROM review;
	</select>
	
	<select id="selectAllReview">
		select count(*) from review;
	</select>
</mapper>















